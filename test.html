<template>
	<div class="form-card" ref="formContainer">
		<!-- 出席人列表视图 -->
		<div class="view-list" :style="{ transform: `translateX(${listOffset}px)` }" @touchstart="handleTouchStart"
			@touchmove="handleTouchMove" @touchend="handleTouchEnd">
			<div class="add-attendee" @click="addAttendee">
				<i class="ri-add-circle-line"></i> 新增出席人员
			</div>

			<div v-for="(attendee, index) in attendees" :key="attendee.id" class="attendee-item"
				:class="{ active: currentAttendee?.id === attendee.id }" @click="editAttendee(attendee)">
				<div class="name">{{ attendee.name }}</div>
				<div class="details">
					<div><i class="ri-hotel-line"></i> 需要住宿</div>
					<div><i class="ri-calendar-line"></i> 入住日期: {{ attendee.checkInDate }}</div>
					<div><i class="ri-home-line"></i> 入住房型: {{ attendee.roomType }}</div>
				</div>
				<button class="edit-btn" @click.stop="editAttendee(attendee)">
					<i class="ri-edit-line"></i>
				</button>
			</div>
		</div>

		<!-- 编辑表单视图 -->
		<div class="view-form" :style="{ transform: `translateX(${formOffset}px)` }">
			<div class="form-header">
				<h3>编辑出席人信息</h3>
				<button class="close-btn" @click="cancelEdit">×</button>
			</div>

			<form @submit.prevent="saveAttendee">
				<div class="form-group">
					<label>*姓名</label>
					<input type="text" v-model="currentAttendee.name" placeholder="请输入姓名（必填）" required>
				</div>

				<div class="form-group">
					<label>*性别</label>
					<div class="radio-group">
						<label><input type="radio" name="gender" value="男" v-model="currentAttendee.gender"> 男</label>
						<label><input type="radio" name="gender" value="女" v-model="currentAttendee.gender"> 女</label>
					</div>
				</div>

				<div class="form-group">
					<label>手机</label>
					<input type="tel" v-model="currentAttendee.phone" placeholder="13600000000">
				</div>

				<div class="form-group">
					<label>*公司名称</label>
					<input type="text" v-model="currentAttendee.company" placeholder="请输入公司名称（必填）" required>
				</div>

				<div class="form-group">
					<label>*职位</label>
					<input type="text" v-model="currentAttendee.position" placeholder="请输入职位（必填）" required>
				</div>

				<div class="form-group">
					<label>*是否需要安排住宿</label>
					<div class="radio-group">
						<label><input type="radio" name="accommodation" value="需要"
								v-model="currentAttendee.needAccommodation"> 需要</label>
						<label><input type="radio" name="accommodation" value="不需要"
								v-model="currentAttendee.needAccommodation"> 不需要</label>
					</div>
				</div>

				<div class="form-group" v-if="currentAttendee.needAccommodation === '需要'">
					<label>*住宿安排</label>
					<select v-model="currentAttendee.accommodationArrangement">
						<option value="">请下拉选择</option>
						<option value="大床房">大床房</option>
						<option value="双床房">双床房</option>
						<option value="套房">套房</option>
					</select>
				</div>

				<div class="form-group" v-if="currentAttendee.needAccommodation === '需要'">
					<label>*住宿日期</label>
					<div class="radio-group">
						<label><input type="radio" name="checkInDate" value="9.21晚"
								v-model="currentAttendee.checkInDate"> 9.21晚</label>
						<label><input type="radio" name="checkInDate" value="9.22晚"
								v-model="currentAttendee.checkInDate"> 9.22晚</label>
						<label><input type="radio" name="checkInDate" value="9.21晚+9.22晚"
								v-model="currentAttendee.checkInDate"> 9.21晚+9.22晚</label>
					</div>
				</div>

				<div class="form-group">
					<label>自驾车牌</label>
					<input type="text" v-model="currentAttendee.carPlate" placeholder="请输入自驾车牌（如有）">
				</div>

				<div class="form-actions">
					<button type="button" class="btn delete-btn" @click="deleteAttendee(currentAttendee)">删除</button>
					<button type="submit" class="btn save-btn">保存</button>
				</div>
			</form>
		</div>
	</div>
</template>

<script>
	export default {
		data() {
			return {
				attendees: [{
						id: 1,
						name: '张大毛',
						gender: '男',
						phone: '',
						company: '',
						position: '',
						needAccommodation: '需要',
						accommodationArrangement: '大床房',
						checkInDate: '9.21晚+9.22晚',
						carPlate: ''
					},
					{
						id: 2,
						name: '李大毛',
						gender: '男',
						phone: '',
						company: '',
						position: '',
						needAccommodation: '需要',
						accommodationArrangement: '大床房',
						checkInDate: '9.21晚+9.22晚',
						carPlate: ''
					}
				],
				currentAttendee: null,
				listOffset: 0,
				formOffset: 100,
				startX: 0,
				startY: 0
			};
		},

		methods: {
			// 新增出席人
			addAttendee() {
				const newAttendee = {
					id: Date.now(),
					name: '',
					gender: '男',
					phone: '',
					company: '',
					position: '',
					needAccommodation: '需要',
					accommodationArrangement: '',
					checkInDate: '9.21晚',
					carPlate: ''
				};
				this.currentAttendee = newAttendee;
				this.showForm();
			},

			// 编辑出席人
			editAttendee(attendee) {
				this.currentAttendee = {
					...attendee
				};
				this.showForm();
			},

			// 删除出席人
			deleteAttendee(attendee) {
				if (confirm('确定要删除该出席人吗？')) {
					const index = this.attendees.findIndex(a => a.id === attendee.id);
					if (index !== -1) {
						this.attendees.splice(index, 1);
					}
					this.cancelEdit();
				}
			},

			// 保存出席人信息
			saveAttendee() {
				// 表单验证
				if (!this.currentAttendee.name || !this.currentAttendee.company || !this.currentAttendee.position) {
					alert('请填写必填项！');
					return;
				}

				const index = this.attendees.findIndex(a => a.id === this.currentAttendee.id);
				if (index !== -1) {
					// 更新现有出席人
					this.$set(this.attendees, index, {
						...this.currentAttendee
					});
				} else {
					// 新增出席人
					this.attendees.push({
						...this.currentAttendee
					});
				}
				this.cancelEdit();
			},

			// 取消编辑
			cancelEdit() {
				this.currentAttendee = null;
				this.hideForm();
			},

			// 显示表单视图
			showForm() {
				this.listOffset = -100;
				this.formOffset = 0;
			},

			// 隐藏表单视图
			hideForm() {
				this.listOffset = 0;
				this.formOffset = 100;
			},

			// 触摸开始事件
			handleTouchStart(e) {
				this.startX = e.touches[0].clientX;
				this.startY = e.touches[0].clientY;
			},

			// 触摸移动事件
			handleTouchMove(e) {
				if (this.currentAttendee) return; // 已在表单视图时不处理

				const moveX = e.touches[0].clientX;
				const moveY = e.touches[0].clientY;
				const diffX = this.startX - moveX;
				const diffY = this.startY - moveY;

				// 只处理水平滑动
				if (Math.abs(diffX) > Math.abs(diffY)) {
					e.preventDefault();
					this.listOffset = Math.max(-100, Math.min(0, diffX / window.innerWidth * 100));
				}
			},

			// 触摸结束事件
			handleTouchEnd(e) {
				if (this.currentAttendee) return;

				const endX = e.changedTouches[0].clientX;
				const diffX = this.startX - endX;

				if (diffX > 50) {
					this.showForm();
				} else if (diffX < -50) {
					this.cancelEdit();
				} else {
					this.listOffset = 0;
				}
			}
		}
	};
</script>

<style lang="scss" scoped>
	.form-card {
		position: relative;
		width: 100%;
		height: 100%;
		overflow: hidden;
		background-color: #f8f9fa;
	}

	.view-list,
	.view-form {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}

	/* 出席人列表视图 */
	.view-list {
		background-color: #f8f9fa;
		padding: 20px;
	}

	.add-attendee {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 15px;
		border: 1px dashed #ccc;
		border-radius: 8px;
		margin-bottom: 15px;
		cursor: pointer;
		color: #007bff;
	}

	.attendee-item {
		background-color: #fff;
		border-radius: 8px;
		padding: 15px;
		margin-bottom: 10px;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
		position: relative;
		cursor: pointer;

		&.active {
			background-color: #e6f7ff;
		}

		.name {
			font-weight: bold;
			margin-bottom: 5px;
		}

		.details {
			font-size: 14px;
			color: #666;
			margin-bottom: 10px;
		}

		.edit-btn {
			position: absolute;
			right: 10px;
			top: 50%;
			transform: translateY(-50%);
			background: none;
			border: none;
			color: #999;
			cursor: pointer;
		}
	}

	/* 编辑表单视图 */
	.view-form {
		background-color: #fff;
		padding: 20px;
		z-index: 10;
	}

	.form-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20px;

		h3 {
			margin: 0;
		}

		.close-btn {
			background: none;
			border: none;
			font-size: 24px;
			cursor: pointer;
			color: #999;
		}
	}

	.form-group {
		margin-bottom: 20px;

		label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
		}

		input,
		select {
			width: 100%;
			padding: 10px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 16px;
		}

		.radio-group {
			display: flex;
			gap: 20px;
			margin-top: 5px;
		}

		.radio-group label {
			display: flex;
			align-items: center;
			cursor: pointer;
		}

		.radio-group input[type="radio"] {
			margin-right: 5px;
		}
	}

	.form-actions {
		display: flex;
		gap: 10px;
		margin-top: 30px;

		.btn {
			flex: 1;
			padding: 12px;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
		}

		.delete-btn {
			background-color: #dc3545;
			color: white;
		}

		.save-btn {
			background-color: #007bff;
			color: white;
		}
	}
</style>